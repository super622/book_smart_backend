"use strict";var jwt=require("jsonwebtoken"),db=require("../models"),Auth=db.authentications,Clinical=db.clinical,Facility=db.facilities,expirationTime=2592e3,verifyToken=function(n,r,i){var e=n.headers.authorization;if(console.log(e),e){console.log("hhhhhh");var s=e.split(" ")[1];if(!s)return r.status(401).json({success:!1,message:"You are not authorized!"});jwt.verify(s,process.env.JWT_SECRET_KEY,function(e,s){if(e)return console.log("err",e),r.status(401).json({success:!1,message:"Token is invalid"});n.user=s,i()})}},setToken=function(e){return console.log(process.env.JWT_SECRET_KEY),jwt.sign(e,process.env.JWT_SECRET_KEY)},verifyUser=function(n,r,i){console.log("verifyToken"),verifyToken(n,r,function(){var s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(s={},"Facilities"===n.user.userRole)return e.next=4,regeneratorRuntime.awrap(Facility.findOne({email:n.user.email,userRole:n.user.userRole}));e.next=7;break;case 4:s=e.sent,e.next=11;break;case 7:if("Clinician"===n.user.userRole)return e.next=10,regeneratorRuntime.awrap(Clinical.findOne({email:n.user.email,userRole:n.user.userRole}));e.next=11;break;case 10:s=e.sent;case 11:s?Math.floor(Date.now()/1e3)<n.user.exp?(n.user=s,i()):r.status(401).json({success:!1,message:"Token is expired"}):r.status(401).json({success:!1,message:"You are not authenticated!"});case 12:case"end":return e.stop()}})})},verifyAdmin=function(e,s,n){verifyToken(e,s,function(){if("admin"!==e.user.role)return s.status(401).json({success:!1,message:"You are not authorized"});n()})};module.exports={verifyToken:verifyToken,verifyUser:verifyUser,verifyAdmin:verifyAdmin,setToken:setToken};
//# sourceMappingURL=verifyToken.min.js.map
